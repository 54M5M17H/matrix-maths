machine:
    node:
        version: 8

dependencies:
    override:
        - echo "//registry.npmjs.org/:_authToken=$NPM_TOKEN" >> ~/.npmrc
        - npm install

test:
    override:
        - npm test
        - npm run lint

deployment:
    production:
        branch: master
        commands:
            - git config --global user.email "sam.smith@oneflow.io"
            - git config --global user.name "Circle CI"
            - git reset --hard HEAD
            - git tag "v`grep '"version"' package.json | egrep -o "[0-9]+.[0-9]+.[0-9]+"`"
            - git push --tags
           
            - git checkout master
            - git pull
            - npm --no-git-tag-version version patch
            - git commit -m "`grep '"version"' package.json | egrep -o "[0-9]+.[0-9]+.[0-9]+"`"
            - git push -u origin circle-ci-version-bump:master --follow-tags
            - npm publish